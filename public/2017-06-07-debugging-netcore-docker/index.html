<!DOCTYPE html>






<html prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Jonathan Channon Blog - Debugging .Net Core apps inside Docker container with VSCode</title>
        <meta name="description" content="So by now using .Net Core on Linux is old news, everyone is doing it and deploying their production apps on Kubernetes to reach peak &ldquo;I can scale&rdquo; points.  However, one thing that can get tricky is when you have a requirement to debug an application in a container.  I believe VS on Windows and VS for Mac has some sort of capability to do that (I have no idea what it does underneath but hey who cares I can right click debug right!?) but the information about doing this in VSCode is a bit sketchy.  I tend to use VSCode on OSX the most so I wanted to see how I could do this.
For demonstration purposes lets take a very simple application and we are going to publish it as a self contained application ie/one that has all the runtime and application binaries outputted so you don&rsquo;t have to install dotnet in a container.
To be able to debug that application we are going to need VSDBG(the .Net Core command line debugger) inside the container.
curl -sSL https://aka.ms/getvsdbgsh | bash /dev/stdin -v latest -l ~/vsdbg
We are also going to need to append the launch.json for VSCode in your project&rsquo;s root to have the below:
{
    &quot;name&quot;: &quot;.NET Core Remote Attach&quot;,
    &quot;type&quot;: &quot;coreclr&quot;,
    &quot;request&quot;: &quot;attach&quot;,
    &quot;processId&quot;: &quot;${command:pickRemoteProcess}&quot;,
    &quot;pipeTransport&quot;: {
        &quot;pipeProgram&quot;: &quot;bash&quot;,
        &quot;pipeArgs&quot;: [ &quot;-c&quot;, &quot;docker exec -i json ${debuggerCommand}&quot; ],
        &quot;debuggerPath&quot;: &quot;/root/vsdbg/vsdbg&quot;,
        &quot;pipeCwd&quot;: &quot;${workspaceRoot}&quot;,
        &quot;quoteArgs&quot;: true
    },
    &quot;sourceFileMap&quot;: {
        &quot;/Users/jonathan/Projects/jsonfile&quot;: &quot;${workspaceRoot}&quot;
    },
    &quot;justMyCode&quot;: true
}
">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.69.2" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="google-site-verification" content="9bvoj2jXRyykef2Tg72C0Am15YBTqDF0RgeZ84tUytE" />
        <meta property="og:title" content="Debugging .Net Core apps inside Docker container with VSCode">
<meta property="og:description" content="So by now using .Net Core on Linux is old news, everyone is doing it and deploying their production apps on Kubernetes to reach peak &ldquo;I can scale&rdquo; points.  However, one thing that can get tricky is when you have a requirement to debug an application in a container.  I believe VS on Windows and VS for Mac has some sort of capability to do that (I have no idea what it does underneath but hey who cares I can right click debug right!?) but the information about doing this in VSCode is a bit sketchy.  I tend to use VSCode on OSX the most so I wanted to see how I could do this.
For demonstration purposes lets take a very simple application and we are going to publish it as a self contained application ie/one that has all the runtime and application binaries outputted so you don&rsquo;t have to install dotnet in a container.
To be able to debug that application we are going to need VSDBG(the .Net Core command line debugger) inside the container.
curl -sSL https://aka.ms/getvsdbgsh | bash /dev/stdin -v latest -l ~/vsdbg
We are also going to need to append the launch.json for VSCode in your project&rsquo;s root to have the below:
{
    &quot;name&quot;: &quot;.NET Core Remote Attach&quot;,
    &quot;type&quot;: &quot;coreclr&quot;,
    &quot;request&quot;: &quot;attach&quot;,
    &quot;processId&quot;: &quot;${command:pickRemoteProcess}&quot;,
    &quot;pipeTransport&quot;: {
        &quot;pipeProgram&quot;: &quot;bash&quot;,
        &quot;pipeArgs&quot;: [ &quot;-c&quot;, &quot;docker exec -i json ${debuggerCommand}&quot; ],
        &quot;debuggerPath&quot;: &quot;/root/vsdbg/vsdbg&quot;,
        &quot;pipeCwd&quot;: &quot;${workspaceRoot}&quot;,
        &quot;quoteArgs&quot;: true
    },
    &quot;sourceFileMap&quot;: {
        &quot;/Users/jonathan/Projects/jsonfile&quot;: &quot;${workspaceRoot}&quot;
    },
    &quot;justMyCode&quot;: true
}
">
<meta property="og:type" content="article">
<meta property="og:url" content="/2017-06-07-debugging-netcore-docker/">
        <link href='http://fonts.googleapis.com/css?family=Lato:300,400,700%7CCourgette' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/dist/site.css">
        <link rel="stylesheet" href="/dist/syntax.css">
        <link rel="stylesheet" href="/dist/screen.css" media="screen" >
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
            <link href="/2017-06-07-debugging-netcore-docker/feed.xml" rel="alternate" type="application/rss+xml" title="Jonathan Channon Blog">
        
        
        
        
    </head>
    <body>
        

        <div class="body_wrap">
            <div class="logo">
                <strong><a href="index.html">Blog</a></strong>
                <div class="logo_description">curated by Jonathan Channon</div>
            </div>
            
            <div class="header">            
                <div class="header_inner">
                        
                    <nav id="topmenu" class="clearfix">
                        <ul class="dropdown">
                            <li class="menu-item-blue"><a href="/"><span>Home</span></a></li>
                            <li class="menu-item-pink"><a href="/archive"><span>Archive</span></a></li>
                        </ul>
                    
                    <select id="topm-select" onChange="location = this.value">
                        <option value="">Site Navigation</option>
                        <option value="/">Home</option>
                        <option value="/about">About Me</option>

                        <option value="/archive">Archive</option>
                        <option value="/contact">Contact</option>
                    </select>
                    </nav>    
                    

                </div>
            </div>
              
            
            <div id="middle" class="full_width">
                <div class="container clearfix">                        
                    
                    <div> 
            


<div class="post-item boxed post-detail" itemtype="http://schema.org/BlogPosting">
    <span class="post-label label-quotes"></span>           
    <div class="post-title">
      <h1><a href="/2017-06-07-debugging-netcore-docker/">Debugging .Net Core apps inside Docker container with VSCode</a></h1>
    </div>
    <div class="post-meta-top">
        <span class="post-date">June 7, 2017</span> 
        
        <div class="commentcount" data-disqus-url="/2017-06-07-debugging-netcore-docker/"></div>
    </div>
    
    <div class="post-descr entry">
        <p>So by now using .Net Core on Linux is old news, everyone is doing it and deploying their production apps on Kubernetes to reach peak &ldquo;I can scale&rdquo; points.  However, one thing that can get tricky is when you have a requirement to debug an application in a container.  I believe VS on Windows and VS for Mac has some sort of capability to do that (I have no idea what it does underneath but hey who cares I can right click debug right!?) but the information about doing this in VSCode is a bit sketchy.  I tend to use VSCode on OSX the most so I wanted to see how I could do this.</p>
<p>For demonstration purposes lets take a very simple application and we are going to publish it as a self contained application ie/one that has all the runtime and application binaries outputted so you don&rsquo;t have to install dotnet in a container.</p>
<p>To be able to debug that application we are going to need VSDBG(the .Net Core command line debugger) inside the container.</p>
<p><code>curl -sSL https://aka.ms/getvsdbgsh | bash /dev/stdin -v latest -l ~/vsdbg</code></p>
<p>We are also going to need to append the launch.json for VSCode in your project&rsquo;s root to have the below:</p>
<pre><code>{
    &quot;name&quot;: &quot;.NET Core Remote Attach&quot;,
    &quot;type&quot;: &quot;coreclr&quot;,
    &quot;request&quot;: &quot;attach&quot;,
    &quot;processId&quot;: &quot;${command:pickRemoteProcess}&quot;,
    &quot;pipeTransport&quot;: {
        &quot;pipeProgram&quot;: &quot;bash&quot;,
        &quot;pipeArgs&quot;: [ &quot;-c&quot;, &quot;docker exec -i json ${debuggerCommand}&quot; ],
        &quot;debuggerPath&quot;: &quot;/root/vsdbg/vsdbg&quot;,
        &quot;pipeCwd&quot;: &quot;${workspaceRoot}&quot;,
        &quot;quoteArgs&quot;: true
    },
    &quot;sourceFileMap&quot;: {
        &quot;/Users/jonathan/Projects/jsonfile&quot;: &quot;${workspaceRoot}&quot;
    },
    &quot;justMyCode&quot;: true
}
</code></pre>
<p>They key things to note are the <code>pipeArgs</code> and <code>sourceFileMap</code>. Where it says <code>json</code>, under <code>pipeArgs</code> this will need to be replaced the name of the container that you are trying to debug.  The <code>sourceFileMap</code> is a mapping between where it was compiled on your machine and where it is in VSCode.  The rest of the properties are explained <a href="https://github.com/OmniSharp/omnisharp-vscode/wiki/Attaching-to-remote-processes#configuring-launchjson">here</a></p>
<p>The final Dockerfile looks like this:</p>
<pre><code>FROM microsoft/dotnet:1.1-runtime-deps

RUN apt-get update

RUN apt-get install curl unzip

RUN curl -sSL https://aka.ms/getvsdbgsh | bash /dev/stdin -v latest -l ~/vsdbg

COPY ./publish /app

WORKDIR /app

ENTRYPOINT ./jsonfile
</code></pre>
<p>So we&rsquo;re ready to go with the following steps:</p>
<p><code>dotnet publish -c Debug -f netcoreapp1.1 -r debian.8-x64 -o ./publish</code></p>
<p><code>docker build -t jchannon/jsonfile --rm .</code></p>
<p><code>docker run -t —name json jchannon/jsonfile</code></p>
<p>Add a breakpoint to you application</p>
<p>Go to VSCode Debug pane, select <code>.NET Core Remote Attach</code> and hit F5</p>
<p>SUCCESS!!</p>
<p>One thing to note with this is, is that you cannot debug a project that has been compiled in Release mode.  Whilst the config above looks like it should work it doesn&rsquo;t. I tried! I believe there may be plans to allow this and the issue can be tracked <a href="https://github.com/OmniSharp/omnisharp-vscode/issues/220">here</a> .  A sample application and Dockerfile can be found <a href="https://github.com/jchannon/DockerDebug">here</a></p>
    </div> 
    
        <div id="tagcloud">   
            
            
                <a href="/tags/oss/"><span>OSS</span></a>
            
                <a href="/tags/asp.net/"><span>ASP.NET</span></a>
            
                <a href="/tags/csharp/"><span>csharp</span></a>
            
                <a href="/tags/docker/"><span>Docker</span></a>
                     
        </div>
    
    
    <span itemprop="author" itemscope itemtype="http://schema.org/Person">
        <meta itemprop="name" content="Jonathan Channon">
    </span>
    
<div id="disqus_thread"></div>
<script>

    


    var disqus_config = function () {
        this.page.url = '\/2017-06-07-debugging-netcore-docker\/';  
        this.page.identifier = ''; 
    };

    (function () { 
        var d = document, s = d.createElement('script');
        s.src = '//jonathanchannonblog.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>

        </div>
        
    </div>
</div>



<div class="footer_social">
    <div class="footer_social_inner">
        <div class="container">
            
                <a class="social-twitter" data-hint="Twitter" title="Twitter" href="https://twitter.com/jchannon" rel="me">Twitter</a>
            
            
                <a class="social-github" data-hint="Github" title="Github" href="https://github.com/jchannon" rel="me">Github</a>
            
            
                <a class="social-linkedin" data-hint="LinkedIn" title="Linked In" href="http://uk.linkedin.com/in/jonathanchannon" rel="me">Linked In</a>
            
            
                <a href="/feed.xml" class="social-rss">RSS Feed</a>
            
        </div>
    </div>
</div>



</div>


<script src="//js/libs/modernizr.min.js"></script>
<script src="//js/libs/respond.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>


<script src="//js/general.js"></script>
<script src="//js/hoverIntent.js"></script>

<script type='text/javascript'>
    $(function () {
        $("pre code").parent().each(function () {
            if (!$(this).hasClass("prettyprint")) {
                $(this).addClass("prettyprint");
                a = true
            }
        });
        
    });
</script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=sons-of-obsidian"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>

</html>
